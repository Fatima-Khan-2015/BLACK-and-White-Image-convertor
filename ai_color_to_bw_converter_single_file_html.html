<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Color → Black & White Converter</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071027 0%, #071a2e 60%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .wrap{max-width:980px;width:100%;display:grid;grid-template-columns:1fr 380px;gap:24px;align-items:start}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:20px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header h1{margin:0;font-size:20px;letter-spacing:-0.2px}
    header p{color:var(--muted);margin:8px 0 18px;font-size:13px}
    .uploader{border:2px dashed rgba(255,255,255,0.06);padding:22px;border-radius:12px;display:flex;flex-direction:column;align-items:center;gap:12px;cursor:pointer;transition:all .18s}
    .uploader.drag{border-color:var(--accent);transform:translateY(-4px)}
    .uploader input{display:none}
    .preview{width:100%;height:420px;background:linear-gradient(180deg,#0a1624,#071027);display:flex;align-items:center;justify-content:center;border-radius:10px;overflow:hidden;position:relative}
    .preview canvas{max-width:100%;max-height:100%;display:block}
    .controls{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .row{display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:var(--muted)}
    .btn{background:linear-gradient(90deg,var(--accent),#34d399);border:none;color:#032018;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .side{position:sticky;top:28px}
    .info{font-size:13px;color:var(--muted)}
    .slider{width:100%}
    .small{font-size:12px;color:var(--muted)}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .meta span{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    footer{margin-top:10px;font-size:12px;color:var(--muted)}
    @media (max-width:980px){.wrap{grid-template-columns:1fr;}.preview{height:320px}}
  




  </style>

</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>AI Color → Black &amp; White Converter</h1>
        <p>Upload a colored image and convert it into a high-quality black & white image. Try the "AI Enhance" toggle for contrast-preserving conversion (histogram equalization).</p>
      </header>

      <label class="uploader" id="uploader">
        <input id="fileInput" type="file" accept="image/*">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 3v12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="13" width="18" height="8" rx="2" stroke="currentColor" stroke-width="1.5"/></svg>
        <div style="text-align:center">
          <div style="font-weight:600">Click or drag & drop an image</div>
          <div class="small">Supports PNG, JPG, WebP • Up to 15MB</div>
        </div>
      </label>

      <div class="preview" id="previewArea">
        <div style="text-align:center;color:var(--muted);padding:18px">
          <strong>No image yet</strong>
          <div class="small">Upload to see a live preview and controls</div>
        </div>
        <canvas id="canvas" style="display:none"></canvas>
        <img id="origImg" alt="original" style="display:none;max-width:100%;max-height:100%">
      </div>

      <div class="controls">
        <div class="row">
          <label for="intensity">Grayscale intensity</label>
          <input id="intensity" class="slider" type="range" min="0" max="100" value="100">
        </div>
        <div class="row">
          <label for="method">Conversion method</label>
          <select id="method" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
            <option value="lum">Luminosity (most natural)</option>
            <option value="avg">Average</option>
            <option value="desat">Desaturation (HSL)</option>
          </select>
        </div>
        <div class="row">
          <label style="display:flex;align-items:center;gap:8px"><input id="aiEnhance" type="checkbox"> AI Enhance</label>
          <div class="small">(applies contrast-preserving histogram equalization)</div>
        </div>
        <div class="row" style="justify-content:flex-end">
          <button class="btn" id="convertBtn">Convert</button>
          <button class="btn ghost" id="resetBtn">Reset</button>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn ghost" id="downloadBtn" disabled>Download B&amp;W</button>
        </div>

        <footer>
          Tip: Use the intensity slider to blend the original color with the black & white (100 = fully B&amp;W).
        </footer>
      </div>
    </div>

    <aside class="card side">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:68px;height:68px;flex-shrink:0;border-radius:14px;background:linear-gradient(90deg,var(--accent),#34d399);display:flex;align-items:center;justify-content:center;color:#032018;font-weight:700">AI</div>
        <div>
          <div style="font-weight:700">AI-powered B&amp;W</div>
          <div class="info">Natural grayscale conversion + optional contrast enhancement. No image leaves your browser — everything runs locally.</div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="meta">
          <span>Local processing</span>
          <span>Downloadable</span>
          <span>Responsive</span>
        </div>
      </div>

      <div style="margin-top:16px">
        <h4 style="margin:0 0 8px 0">How to use</h4>
        <ol class="small" style="margin:0 0 12px 18px;padding:0">
          <li>Click the upload area or drop an image.</li>
          <li>Adjust intensity, method, or enable AI Enhance.</li>
          <li>Click Convert, then Download to save the result.</li>
        </ol>
        <div class="small">File is processed in your browser for privacy and speed.</div>
      </div>
    </aside>
  </div>

<script>
const uploader = document.getElementById('uploader');
const fileInput = document.getElementById('fileInput');
const previewArea = document.getElementById('previewArea');
const canvas = document.getElementById('canvas');
const origImg = document.getElementById('origImg');
const intensity = document.getElementById('intensity');
const method = document.getElementById('method');
const aiEnhance = document.getElementById('aiEnhance');
const convertBtn = document.getElementById('convertBtn');
const resetBtn = document.getElementById('resetBtn');
const downloadBtn = document.getElementById('downloadBtn');
let imgLoaded = false;
let imgDataURL = null;

// drag & drop
['dragenter','dragover'].forEach(ev => {
  uploader.addEventListener(ev, (e)=>{e.preventDefault();uploader.classList.add('drag')});
});
['dragleave','drop'].forEach(ev => {
  uploader.addEventListener(ev, (e)=>{e.preventDefault();uploader.classList.remove('drag')});
});

uploader.addEventListener('drop', (e)=>{
  const f = e.dataTransfer.files[0];
  if (f) handleFile(f);
});

uploader.addEventListener('click', ()=>fileInput.click());
fileInput.addEventListener('change', ()=>handleFile(fileInput.files[0]));

function handleFile(file){
  if (!file) return;
  if (!file.type.startsWith('image/')){alert('Please select an image file.');return}
  const reader = new FileReader();
  reader.onload = ()=>{
    imgDataURL = reader.result;
    origImg.src = imgDataURL;
    origImg.style.display = 'block';
    canvas.style.display = 'none';
    imgLoaded = true;
    downloadBtn.disabled = true;
    previewArea.querySelector('div')?.remove();
    // fit image
    origImg.onload = ()=>{
      fitCanvasToImage();
    }
  }
  reader.readAsDataURL(file);
}

function fitCanvasToImage(){
  const ctx = canvas.getContext('2d');
  const maxW = previewArea.clientWidth - 0;
  const maxH = previewArea.clientHeight - 0;
  const ratio = Math.min(maxW/origImg.naturalWidth, maxH/origImg.naturalHeight, 1);
  canvas.width = Math.round(origImg.naturalWidth * ratio);
  canvas.height = Math.round(origImg.naturalHeight * ratio);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(origImg,0,0,canvas.width,canvas.height);
}

// conversion functions
function convertImage(){
  if (!imgLoaded) {alert('Please upload an image first.');return}
  fitCanvasToImage();
  canvas.style.display = 'block';
  origImg.style.display = 'none';
  const ctx = canvas.getContext('2d');
  ctx.drawImage(origImg,0,0,canvas.width,canvas.height);
  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  const data = img.data;
  const len = data.length;
  // compute grayscale
  for (let i=0;i<len;i+=4){
    const r = data[i], g = data[i+1], b = data[i+2];
    let gray;
    if (method.value === 'lum'){
      gray = 0.2126*r + 0.7152*g + 0.0722*b; // luminosity
    } else if (method.value === 'avg'){
      gray = (r+g+b)/3;
    } else {
      // desaturation: average of max and min (approx HSL desat)
      const mx = Math.max(r,g,b), mn = Math.min(r,g,b);
      gray = (mx+mn)/2;
    }
    data[i] = data[i+1] = data[i+2] = gray;
  }

  // AI enhance: histogram equalization on grayscale to improve contrast
  if (aiEnhance.checked){
    histogramEqualize(data);
  }

  // intensity blending between original color and bw
  const t = parseInt(intensity.value,10)/100;
  if (t < 1){
    // we need original pixels, so get original image data from a temp canvas
    const temp = document.createElement('canvas');
    temp.width = canvas.width; temp.height = canvas.height;
    const tctx = temp.getContext('2d');
    tctx.drawImage(origImg,0,0,canvas.width,canvas.height);
    const orig = tctx.getImageData(0,0,canvas.width,canvas.height).data;
    for (let i=0;i<len;i+=4){
      data[i]   = Math.round(data[i]*t + orig[i]*(1-t));
      data[i+1] = Math.round(data[i+1]*t + orig[i+1]*(1-t));
      data[i+2] = Math.round(data[i+2]*t + orig[i+2]*(1-t));
    }
  }

  ctx.putImageData(img,0,0);
  downloadBtn.disabled = false;
}

function histogramEqualize(data){
  // data is RGBA with grayscale values repeated; we operate on the red channel only
  const len = data.length/4;
  const hist = new Uint32Array(256);
  for (let i=0;i<data.length;i+=4){hist[data[i]]++;}
  // cdf
  const cdf = new Uint32Array(256);
  cdf[0] = hist[0];
  for (let i=1;i<256;i++) cdf[i] = cdf[i-1] + hist[i];
  const cdfMin = cdf.find(v=>v>0) || 0;
  const total = len;
  // map
  const map = new Uint8Array(256);
  for (let i=0;i<256;i++){
    map[i] = Math.round((cdf[i] - cdfMin) / (total - cdfMin) * 255);
  }
  for (let i=0;i<data.length;i+=4){
    const v = map[data[i]];
    data[i]=data[i+1]=data[i+2]=v;
  }
}

convertBtn.addEventListener('click', convertImage);

resetBtn.addEventListener('click', ()=>{
  imgDataURL = null; imgLoaded=false; origImg.src=''; origImg.style.display='none'; canvas.style.display='none';
  downloadBtn.disabled = true; previewArea.innerHTML = '<div style="text-align:center;color:var(--muted);padding:18px"><strong>No image yet</strong><div class="small">Upload to see a live preview and controls</div></div>';
});

downloadBtn.addEventListener('click', ()=>{
  const link = document.createElement('a');
  link.download = 'bw-conversion.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});

// small UX niceties: keyboard paste
window.addEventListener('paste', (e)=>{
  const items = e.clipboardData?.items;
  if (!items) return;
  for (const it of items){
    if (it.type && it.type.startsWith('image/')){
      const f = it.getAsFile(); handleFile(f); break;
    }
  }
});

// responsive: when window resizes, refit canvas
let resizeTO;
window.addEventListener('resize', ()=>{clearTimeout(resizeTO); resizeTO=setTimeout(()=>{if(imgLoaded) fitCanvasToImage()},120)});

</script>
</body>
</html>
